#!/bin/bash -eu

# source common environment and functions
source "$(dirname "$0")/common"

# determine active cluster (in case we have blue/green gardens and soils)
active_cluster_repo_path="$(determine_active_cluster_repo_path)"
kubeconfig_path="$active_cluster_repo_path/gen/assets/auth/kubeconfig"

# check prerequisites
[[ ! -f "$kubeconfig_path" ]] && fail "Active Garden cluster's kubeconfig not found!"

# call helm
KUBECONFIG="$kubeconfig_path" \
HELM_HOME="$LANDSCAPE_HOME/.helm" \
"$(lookup_command helm)" "$@"

# add group write permissions on all helm artifacts
chmod g+w -R "$LANDSCAPE_HOME/.helm" || true
